---
import { getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { translations, type Language } from '../../i18n/translations';
import { getStaticPaths as getI18nStaticPaths } from '../../i18n/utils';

export function getStaticPaths() {
  return getI18nStaticPaths();
}

const { lang } = Astro.params;
const t = translations[lang as Language];

const experienceEntry = await getEntry('experience', lang as Language);
const projectsEntry = await getEntry('projects', lang as Language);
const certificationsEntry = await getEntry('certifications', lang as Language);
const educationEntry = await getEntry('education', lang as Language);

const experience = experienceEntry?.data ?? [];
const projects = projectsEntry?.data ?? [];
const certifications = certificationsEntry?.data ?? [];
const education = educationEntry?.data ?? [];

const socials = [
  { label: t.nav.github, href: 'https://github.com/dosvic' },
  { label: t.nav.linkedin, href: 'https://www.linkedin.com/in/deniz-osmanovic-60a4ba239/' }
];
const [github, linkedin] = socials;

const skills = [
  'JavaScript',
  'TypeScript',
  'Angular',
  'Astro',
  'Node.js',
  'SQL',
  'Java',
  'Jakarte EE/Java EE',
  'Spring Boot',
  'Python',
  'AWS',
  'Kubernetes',
  'GitLab CI/CD',
  'Jenkins'
];

const currentYear = new Date().getFullYear();
const copyright = t.footer.copyright.replace('{year}', currentYear.toString());
---
<BaseLayout
  title={t.meta.title}
  description={t.meta.description}
  lang={lang}
>
  <main class="mx-auto flex min-h-screen w-full max-w-3xl flex-col gap-16 px-6 py-16 sm:px-8">
    <section id="hero" class="space-y-6">
      <p class="text-sm text-subtle">{t.hero.subtitle}</p>
      <h1 class="text-4xl font-semibold leading-tight sm:text-5xl">Deniz Osmanovic</h1>
      <p class="max-w-3xl text-lg text-muted">
        {t.hero.bio}
      </p>
      <div class="flex flex-wrap gap-4 text-sm">
        <a
          href={github.href}
          class="underline decoration-theme underline-offset-4 transition hover:decoration-theme"
          target="_blank"
          rel="noopener noreferrer"
        >
          {github.label}
        </a>
        <a
          href={linkedin.href}
          class="underline decoration-theme underline-offset-4 transition hover:decoration-theme"
          target="_blank"
          rel="noopener noreferrer"
        >
          {linkedin.label}
        </a>
      </div>
    </section>

    <section id="experience" class="space-y-6">
      <h2 class="text-2xl font-semibold text-primary">{t.sections.experience}</h2>
      <div class="space-y-8 border-t border-theme pt-6">
        {experience.map(({ company, period, summary, roles }) => (
          <article class="space-y-3">
            <div class="flex flex-wrap items-baseline justify-between gap-2">
              <h3 class="text-lg font-semibold text-primary">{company}</h3>
              <span class="text-sm text-subtle">{period}</span>
            </div>
            <div class="flex flex-wrap gap-2">
              {roles.map(({ title, period: rolePeriod }) => (
                <span class="rounded-full border border-theme-15 bg-surface px-3 py-1 text-xs text-muted">
                  {title} Â· {rolePeriod}
                </span>
              ))}
            </div>
            <p class="text-muted">{summary}</p>
          </article>
        ))}
      </div>
    </section>

    <section id="projects" class="space-y-6">
      <div class="flex items-baseline justify-between gap-2">
        <h2 class="text-2xl font-semibold text-primary">{t.sections.projects}</h2>
        <span class="text-sm text-subtle">{t.projects.selectedWork}</span>
      </div>
      <div class="space-y-6 border-t border-theme pt-6">
        {projects.map(({ name, description, link }) => (
          <article class="space-y-2">
            <div class="flex flex-wrap items-baseline justify-between gap-2">
              <h3 class="text-lg font-semibold text-primary">{name}</h3>
              <a
                href={link}
                class="text-sm underline decoration-theme underline-offset-4 transition hover:decoration-theme"
                target="_blank"
                rel="noopener noreferrer"
              >
                {t.projects.openLink}
              </a>
            </div>
            <p class="text-muted-75">{description}</p>
          </article>
        ))}
      </div>
    </section>

    <section id="skills" class="space-y-4">
      <h2 class="text-2xl font-semibold text-primary">{t.sections.skills}</h2>
      <div class="border-t border-theme pt-4">
        <ul class="flex flex-wrap gap-3">
          {skills.map((skill) => (
            <li class="rounded-full border border-theme-15 bg-surface px-4 py-2 text-sm text-muted">{skill}</li>
          ))}
        </ul>
      </div>
    </section>

    <section id="certifications" class="space-y-4">
      <h2 class="text-2xl font-semibold text-primary">{t.sections.certifications}</h2>
      <div class="space-y-4 border-t border-theme pt-4">
        {certifications.map(({ title, issuer, description, credentialUrl }) => (
          <article class="space-y-2">
            <div class="space-y-1">
              <h3 class="text-lg font-semibold text-primary">{title}</h3>
              <p class="text-sm text-subtle">{issuer}</p>
            </div>
            <p class="text-sm text-muted-70">{description}</p>
            <a
              href={credentialUrl}
              class="text-sm underline decoration-theme underline-offset-4 transition hover:decoration-theme"
              target="_blank"
              rel="noopener noreferrer"
            >
              {t.certifications.credentialLink}
            </a>
          </article>
        ))}
      </div>
    </section>

    <section id="education" class="space-y-4">
      <h2 class="text-2xl font-semibold text-primary">{t.sections.education}</h2>
      <div class="space-y-6 border-t border-theme pt-4">
        {education.map(({ degree, institution, period }) => (
          <article class="space-y-1">
            <div class="flex flex-wrap items-baseline justify-between gap-2">
              <h3 class="text-lg font-semibold text-primary">{degree}</h3>
              <span class="text-sm text-subtle">{period}</span>
            </div>
            <p class="text-muted text-sm">{institution}</p>
          </article>
        ))}
      </div>
    </section>

    <footer class="pb-8 text-xs text-faint">
      {copyright}
    </footer>
  </main>
</BaseLayout>